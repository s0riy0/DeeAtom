<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <title>ATOM INDUSTRY - ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</title>
    <link rel="stylesheet" href="styles.css" />
    <style>
      /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏∑‡πà‡∏ô‡πÜ */
      .master-account-label {
        font-weight: bold;
        color: #2980b9;
      }
    </style>
  </head>
  <body>
    <header>
      <div class="sidebar-logo">
        <img
          src="ChatGPT Image 21 ‡∏°‡∏¥.‡∏¢. 2568 10_23_59.png"
          alt="Atom Industry"
          class="logo"
        />
        <img
          src="DeeCoin.png"
          alt="DEE"
          class="dee-logo"
        />
      </div>
      <div class="user-bar">
        <span class="user-icon">üë§</span>
        <span class="realname" id="name">Loading...</span>
        <button id="logoutBtn">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        <option>‡πÑ‡∏ó‡∏¢</option>
    </header>

    <nav class="sidebar">
      <a href="index.html">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
      <a href="account.html">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</a>
      <a href="All_id.html">- ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</a>
      <a href="add-account.html">- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</a>
      <a href="wallet.html">‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡πÄ‡∏á‡∏¥‡∏ô</a>
      <a href="account-list.html">- ‡∏ï‡∏•‡∏≤‡∏î‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≤‡∏¢</a>
      <a href="withdraw.html">- ‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</a>
      <a href="transaction-history.html">- ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏≥‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°</a>
      <a href="mining-game.html">‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÄ‡∏Å‡∏°‡∏™‡πå</a>
      <a href="other-games.html">- ‡πÄ‡∏Å‡∏°‡∏™‡πå‡∏≠‡∏∑‡πà‡∏ô‡πÜ</a>
      <a href="profile.html">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</a>
      <a href="profile.html">- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</a>
      <a href="setting.html">- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</a>
      <a href="bank-card.html">- Bank card</a>
      <a href="join.html">‡∏£‡πà‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤</a>
    </nav>

    <main class="main-index">
      <div class="page-title">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</div>
      <div class="score-table">
        <table>
          <thead>
            <tr>
              <th>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
              <th>DeeCoin</th>
            </tr>
          </thead>
          <tbody id="accountTableBody">
            </tbody>
        </table>
      </div>
    </main>
    <footer class="footer-account">
      <div class="android-row">
        <span>android</span>
        <img
          src="android-icon-logo-png_seeklogo-306470.png"
          class="android-icon"
          alt="android"
        />
        <img src="frame.png" class="qr-icon" alt="qr code" />
      </div>

      <div class="flag-row">
        <div class="lang-row">
          <img
            src="istockphoto-1032082612-612x612.jpg"
            alt="Thai Flag"
            class="flag"
          />
          <span class="lang-text">‡πÑ‡∏ó‡∏¢</span>
        </div>
      </div>

      <div class="side-social">
        <a href="https://www.facebook.com/profile.php?id=61579275875237"
          ><img src="Facbook.jpg" alt="Facebook"
        /></a>
        <a href="https://lin.ee/RJo5SD2"><img src="Line.jpg" alt="Line" /></a>
      </div>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
        import { getDatabase, ref, onValue, get } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCmrCEiO2kVl5j3VlwPycOYABoEiA0Kkts",
            authDomain: "kudthong-f67a2.firebaseapp.com",
            databaseURL: "https://kudthong-f67a2-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "kudthong-f67a2",
            storageBucket: "kudthong-f67a2.appspot.com",
            messagingSenderId: "140418020508",
            // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç App ID ‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏ú‡∏¥‡∏î
            appId: "1:140418020508:web:1d2feb2b7b1bd9ea0ee959",
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);

        onAuthStateChanged(auth, (user) => {
            if (user) {
                const tableBody = document.getElementById("accountTableBody");

                const addRowToTable = (email, deeCoin, isMaster = false) => {
                    const row = document.createElement('tr');
                    const masterLabel = isMaster ? ' <span class="master-account-label">(‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏´‡∏•‡∏±‡∏Å)</span>' : '';
                    row.innerHTML = `<td>${email}${masterLabel}</td><td>${(deeCoin || 0).toFixed(4)}</td>`;
                    
                    if (isMaster) {
                        tableBody.prepend(row);
                    } else {
                        tableBody.appendChild(row);
                    }
                };

                const mainUserRef = ref(database, `usersID/${user.uid}`);
                onValue(mainUserRef, async (snapshot) => {
                    tableBody.innerHTML = ''; // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á

                    const userData = snapshot.val();

                    // 1. ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏´‡∏•‡∏±‡∏Å
                    if (userData && userData.profile) {
                        const profile = userData.profile;
                        document.getElementById("name").innerText = profile.realName || profile.nickname || user.email;
                        addRowToTable(profile.email, profile.DeeCoin, true);
                    }

                    // 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏¢‡πà‡∏≠‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                    if (userData && userData.subAccounts) {
                        const subAccountUids = Object.keys(userData.subAccounts);
                        const subAccountPromises = subAccountUids.map(subUid => 
                            get(ref(database, `usersID/${subUid}/profile`))
                        );
                        
                        const subAccountSnapshots = await Promise.all(subAccountPromises);
                        
                        subAccountSnapshots.forEach(subProfileSnapshot => {
                            if (subProfileSnapshot.exists()) {
                                const subProfile = subProfileSnapshot.val();
                                addRowToTable(subProfile.email, subProfile.DeeCoin);
                            }
                        });
                    }
                });
            } else {
                window.location.href = "login.html";
            }
        });

        document.getElementById("logoutBtn").addEventListener("click", () => {
            signOut(auth).then(() => {
                window.location.href = "login.html";
            });
        });
    </script>
  </body>
</html>