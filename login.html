<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <title>DEE ATOM INDUSTRY</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      /* --- Base Styles --- */
      body {
        font-family: Tahoma, Arial, sans-serif;
        margin: 0;
        background: #fff;
        color: #111;
        min-height: 100vh;
      }
      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 30px;
        flex-wrap: wrap;
        gap: 15px;
        position: relative;
        z-index: 10;
      }
      .left-logos {
        display: flex;
        align-items: center;
        gap: 16px;
      }
      .logo.atom-logo {
        width: 100px;
      }
      .logo.dee-logo {
        height: 80px;
        border-radius: 50%;
      }
      .right-buttons {
        display: flex;
        gap: 10px;
      }
      .header-btn {
        font-family: Tahoma, Arial, sans-serif;
        font-size: 16px;
        padding: 8px 20px;
        border-radius: 5px;
        border: 2px solid #222;
        background: #fff;
        color: #111;
        font-weight: bold;
        cursor: pointer;
        transition: background 0.2s, color 0.2s, border-color 0.2s;
      }
      .header-btn.primary {
        background: #111;
        color: #fff;
      }
      .header-btn:hover {
        background: #2f5fa7;
        color: #fff;
        border-color: #2f5fa7;
      }
      main {
        flex: 1;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
        text-align: center;
      }
      .laptop-img {
        max-width: 100%;
        height: auto;
        width: 600px;
      }
      .side-left {
        position: fixed;
        left: 30px;
        top: 50%;
        transform: translateY(-50%);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 15px;
        z-index: 9;
      }
      .android-side-icon,
      .qr-side-icon {
        width: 80px;
      }
      .mobile-hand-img {
        width: 150px;
      }
      .side-icons {
        position: fixed;
        right: 30px;
        top: 50%;
        transform: translateY(-50%);
        display: flex;
        flex-direction: column;
        gap: 15px;
        z-index: 9;
      }
      .side-icon img {
        width: 48px;
        height: 48px;
        border-radius: 8px;
        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.2);
      }
      footer {
        display: flex;
        justify-content: flex-end;
        align-items: center;
        padding: 15px 30px;
      }
      .lang-row {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .flag {
        width: 30px;
      }
      .lang-text {
        font-size: 18px;
      }

      /* --- Modal Styles --- */
      .modal {
        display: none;
        position: fixed;
        z-index: 999;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.4);
        justify-content: center;
        align-items: center;
        padding: 15px;
        overflow-y: auto;
      }
      .modal-content {
        background: #fff;
        padding: 25px;
        border-radius: 10px;
        width: 100%;
        max-width: 380px;
        position: relative;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }
      .close {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 28px;
        color: #888;
        cursor: pointer;
      }
      .modal-header {
        display: flex;
        align-items: center;
        margin-bottom: 20px;
      }
      .flag-modal {
        width: 28px;
        margin-right: 10px;
      }
      .modal-title {
        font-size: 22px;
        font-weight: bold;
      }
      .modal-brand {
        font-size: 15px;
        color: #315ba7;
      }
      label {
        display: block;
        margin-top: 12px;
        margin-bottom: 5px;
        font-size: 15px;
      }
      input[type="email"],
      input[type="password"],
      input[type="text"],
      select {
        width: 100%;
        padding: 10px;
        font-size: 15px;
        border: 1px solid #ccc;
        border-radius: 5px;
        box-sizing: border-box;
      }
      .modal-btn {
        width: 100%;
        font-size: 16px;
        padding: 12px;
        border-radius: 5px;
        border: none;
        background: #315ba7;
        color: #fff;
        margin-top: 20px;
        font-weight: bold;
        cursor: pointer;
        transition: background 0.2s;
      }
      .modal-btn:hover {
        background: #174b99;
      }
      .forgot-row {
        text-align: right;
        margin-top: 8px;
      }
      .forgot-link {
        font-size: 14px;
        color: #2a61c9;
        text-decoration: none;
      }
      .modal-or {
        text-align: center;
        margin: 15px 0;
        color: #888;
        font-size: 14px;
      }
      .register-row {
        text-align: center;
        font-size: 14px;
        margin-top: 15px;
      }
      .register-row a {
        color: #315ba7;
        font-weight: bold;
        text-decoration: none;
      }
      .dob-group {
        display: flex;
        gap: 10px;
      }
      .gender-selection {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 20px;
      }
      .gender-option {
        cursor: pointer;
        border: 2px solid #ddd;
        border-radius: 8px;
        padding: 10px;
        transition: all 0.2s;
        text-align: center;
      }
      .gender-option.selected {
        border-color: #315ba7;
        background: #f0f5ff;
      }
      .register-icon {
        width: 50px;
        height: 50px;
      }
      .register-icon-label {
        font-size: 1em;
        margin-top: 5px;
      }

      /* CSS สำหรับปุ่ม Google */
      .google-btn {
        background-color: #4285f4;
        margin-top: 10px;
      }
      .google-btn:hover {
        background-color: #357ae8;
      }
      .google-btn img {
        width: 18px;
        vertical-align: middle;
        margin-right: 10px;
        background-color: white;
        border-radius: 50%;
        padding: 2px;
      }

      /* --- Responsive Media Queries --- */
      @media (max-width: 1200px) {
        .side-left {
          left: 15px;
        }
        .side-icons {
          right: 15px;
        }
        .laptop-img {
          width: 500px;
        }
      }
      @media (max-width: 767px) {
        header {
          justify-content: center;
        }
        .side-left {
          display: none;
        }
        main {
          padding-bottom: 100px;
        }
        .side-icons {
          top: auto;
          bottom: 15px;
          left: 50%;
          transform: translateX(-50%);
          flex-direction: row;
          background: rgba(255, 255, 255, 0.9);
          padding: 8px 15px;
          border-radius: 50px;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }
        footer {
          justify-content: center;
        }
        .laptop-img {
          width: 90%;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <div class="left-logos">
        <img
          src="pic/ChatGPT Image 21 มิ.ย. 2568 10_23_59.png"
          alt="Atom Industry Logo"
          class="logo atom-logo"
        />
        <img src="pic/DeeCoin.png" alt="Dee Logo" class="logo dee-logo" />
      </div>
      <div class="right-buttons">
        <button class="header-btn" id="loginBtn">เข้าสู่ระบบ</button>
        <button class="header-btn primary" id="registerBtn">ลงทะเบียน</button>
      </div>
    </header>

    <main>
      <div class="side-left">
        <img
          src="pic/android-icon-logo-png_seeklogo-306470.png"
          alt="Android"
          class="android-side-icon"
        />
        <img src="pic/KudThong.png" alt="QR Code" class="qr-side-icon" />
        <img src="pic/Scan.png" alt="Mobile Hand" class="mobile-hand-img" />
      </div>
      <div class="center-content">
        <img src="pic/Notebook.png" alt="Game on Laptop" class="laptop-img" />
      </div>
      <div class="side-icons">
        <a
          href="https://www.facebook.com/profile.php?id=61579275875237"
          class="side-icon"
          ><img src="pic/Facbook.jpg" alt="Facebook"
        /></a>
        <a href="https://lin.ee/RJo5SD2" class="side-icon"
          ><img src="pic/Line.jpg" alt="Line"
        /></a>
      </div>
    </main>

    <footer>
      <div class="lang-row">
        <img
          src="pic/istockphoto-1032082612-612x612.jpg"
          alt="Thai Flag"
          class="flag"
        />
        <span class="lang-text">ไทย</span>
      </div>
    </footer>

    <div id="loginModal" class="modal">
      <div class="modal-content">
        <span class="close" id="closeLogin">&times;</span>
        <form id="loginForm">
          <div class="modal-header">
            <img
              src="pic/istockphoto-1032082612-612x612.jpg"
              class="flag-modal"
              alt="Thai Flag"
            />
            <div>
              <div class="modal-title">เข้าสู่ระบบ</div>
              <div class="modal-brand">ATOM INDUSTRY</div>
            </div>
          </div>
          <label for="loginEmail">อีเมล</label>
          <input type="email" id="loginEmail" required />
          <label for="loginPassword">รหัสผ่าน</label>
          <input type="password" id="loginPassword" required />
          <div class="forgot-row">
            <a href="#" class="forgot-link">ลืมรหัสผ่าน?</a>
          </div>
          <button type="submit" class="modal-btn">เข้าสู่ระบบ</button>

          <div class="modal-or">หรือ</div>

          <button
            type="button"
            id="googleLoginBtn"
            class="modal-btn google-btn"
          >
            <img
              src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg"
              alt="Google icon"
            />
            เข้าสู่ระบบด้วย Google
          </button>

          <div class="register-row">
            <span
              >ยังไม่มีบัญชีใช่ไหม?
              <a href="#" id="switchToRegister">สมัครสมาชิก</a></span
            >
          </div>
        </form>
      </div>
    </div>

    <div id="registerModal" class="modal">
      <div class="modal-content">
        <span class="close" id="closeRegister">&times;</span>
        <form id="registerForm">
          <div class="modal-header">
            <img
              src="pic/istockphoto-1032082612-612x612.jpg"
              alt="thai"
              class="flag-modal"
            />
            <span class="modal-title"
              ><span class="modal-brand">ATOM INDUSTRY</span></span
            >
          </div>
          <label for="regEmail">อีเมล</label>
          <input type="email" id="regEmail" required />
          <label for="regPassword">รหัสผ่าน</label>
          <input type="password" id="regPassword" required />
          <label for="regName">ชื่อเล่น</label>
          <input type="text" id="regName" required />
          <label for="regRealName">ชื่อจริง</label>
          <input type="text" id="regRealName" required />
          <label>เดือนปีเกิด</label>
          <div class="dob-group">
            <select id="regMonth" required>
              <option value="" disabled selected>เดือน</option>
            </select>
            <select id="regYear" required>
              <option value="" disabled selected>ปี</option>
            </select>
          </div>
          <div class="gender-selection">
            <div class="gender-option" data-gender="female">
              <img src="pic/woman.jpg" alt="หญิง" class="register-icon" />
              <div class="register-icon-label">ผู้หญิง</div>
            </div>
            <div class="gender-option" data-gender="male">
              <img src="pic/man.jpg" alt="ชาย" class="register-icon" />
              <div class="register-icon-label">ผู้ชาย</div>
            </div>
          </div>
          <button type="submit" class="modal-btn">Finish</button>
        </form>
      </div>
    </div>

    <script>
      // --- Modal UI Logic (ไม่มีการเปลี่ยนแปลง) ---
      document.addEventListener("DOMContentLoaded", function () {
        const loginModal = document.getElementById("loginModal");
        const registerModal = document.getElementById("registerModal");
        const switchToRegister = document.getElementById("switchToRegister");
        document.getElementById("loginBtn").onclick = () => {
          loginModal.style.display = "flex";
        };
        document.getElementById("registerBtn").onclick = () => {
          registerModal.style.display = "flex";
        };
        document.getElementById("closeLogin").onclick = () => {
          loginModal.style.display = "none";
        };
        document.getElementById("closeRegister").onclick = () => {
          registerModal.style.display = "none";
        };
        switchToRegister.onclick = (e) => {
          e.preventDefault();
          loginModal.style.display = "none";
          registerModal.style.display = "flex";
        };
        window.onclick = (event) => {
          if (event.target === loginModal) loginModal.style.display = "none";
          if (event.target === registerModal)
            registerModal.style.display = "none";
        };
        document.querySelectorAll(".gender-option").forEach((option) => {
          option.addEventListener("click", function () {
            document
              .querySelectorAll(".gender-option")
              .forEach((opt) => opt.classList.remove("selected"));
            this.classList.add("selected");
          });
        });
        const yearSelect = document.getElementById("regYear");
        for (let i = 2010; i >= 1950; i--) {
          yearSelect.innerHTML += `<option value="${i}">${i}</option>`;
        }
        const monthSelect = document.getElementById("regMonth");
        const months = [
          "มกราคม",
          "กุมภาพันธ์",
          "มีนาคม",
          "เมษายน",
          "พฤษภาคม",
          "มิถุนายน",
          "กรกฎาคม",
          "สิงหาคม",
          "กันยายน",
          "ตุลาคม",
          "พฤศจิกายน",
          "ธันวาคม",
        ];
        months.forEach((month, index) => {
          monthSelect.innerHTML += `<option value="${
            index + 1
          }">${month}</option>`;
        });
      });
    </script>

    <script type="module">
      // --- Firebase Logic ---
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
      import {
        getAuth,
        createUserWithEmailAndPassword,
        signInWithEmailAndPassword,
        GoogleAuthProvider,
        signInWithPopup,
      } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
      import {
        getDatabase,
        ref,
        set,
        get,
      } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

      const firebaseConfig = {
        apiKey: "AIzaSyCmrCEiO2kVl5j3VlwPycOYABoEiA0Kkts",
        authDomain: "kudthong-f67a2.firebaseapp.com",
        databaseURL:
          "https://kudthong-f67a2-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "kudthong-f67a2",
        storageBucket: "kudthong-f67a2.appspot.com",
        messagingSenderId: "140418020508",
        appId: "1:140418020508:web:1d2feb2b7b1bd9ea0ee959",
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const database = getDatabase(app);

      // --- Logic for Google Sign-In ---
      document
        .getElementById("googleLoginBtn")
        .addEventListener("click", async () => {
          const provider = new GoogleAuthProvider();
          try {
            const result = await signInWithPopup(auth, provider);
            const user = result.user;

            // ตรวจสอบว่าเป็น admin หรือไม่
            const adminRef = ref(database, "admins/" + user.uid);
            const snapshot = await get(adminRef);
            if (snapshot.exists() && snapshot.val() === true) {
              window.location.href = "Admin.html";
            } else {
              window.location.href = "index.html";
            }
          } catch (error) {
            alert("ไม่สามารถเข้าสู่ระบบด้วย Google ได้: " + error.message);
          }
        });

      // --- Logic for Main Account Registration (Email/Password) ---
      document
        .getElementById("registerForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const email = document.getElementById("regEmail").value;
          const password = document.getElementById("regPassword").value;
          const nickname = document.getElementById("regName").value;
          const realName = document.getElementById("regRealName").value;
          const year = document.getElementById("regYear").value;
          const month = document.getElementById("regMonth").value;
          const gender =
            document.querySelector(".gender-option.selected")?.dataset.gender ||
            "";

          if (!gender) {
            alert("กรุณาเลือกเพศ");
            return;
          }

          try {
            const cred = await createUserWithEmailAndPassword(
              auth,
              email,
              password
            );
            const user = cred.user;
            const today = new Date().toISOString().slice(0, 10);
            const keyBag = `${nickname}${Math.floor(
              100000 + Math.random() * 900000
            )}`;
            const initialUserData = {
              profile: {
                THBwallet: 0,
                KeyBag: keyBag,
                DeeCoin: 0,
                createAt: today,
                email: user.email,
                haveAds: true,
                isAcceptPP: false,
                level: 0,
                nickname: nickname,
                realName: realName,
                birthYear: year,
                birthMonth: month,
                gender: gender,
              },
              WalletBag: {},
            };
            await set(ref(database, "usersID/" + user.uid), initialUserData);
            alert("ลงทะเบียนสำเร็จ!");
            window.location.href = "index.html";
          } catch (error) {
            alert(
              error.code === "auth/email-already-in-use"
                ? "อีเมลนี้ถูกใช้สมัครแล้ว"
                : "เกิดข้อผิดพลาด: " + error.message
            );
          }
        });

      // --- Logic for Email/Password Login ---
      document
        .getElementById("loginForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const email = document.getElementById("loginEmail").value;
          const password = document.getElementById("loginPassword").value;
          try {
            const userCredential = await signInWithEmailAndPassword(
              auth,
              email,
              password
            );
            const user = userCredential.user;

            // ตรวจสอบว่าเป็น admin หรือไม่
            const adminRef = ref(database, "admins/" + user.uid);
            const snapshot = await get(adminRef);
            if (snapshot.exists() && snapshot.val() === true) {
              window.location.href = "Admin.html";
            } else {
              window.location.href = "index.html";
            }
          } catch (err) {
            alert("เข้าสู่ระบบไม่สำเร็จ: " + err.message);
          }
        });
    </script>
  </body>
</html>
