<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <title>ATOM INDUSTRY - ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</title>
    <link rel="stylesheet" href="styles.css" />
    <style>
      /* --- CSS ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå --- */
      .profile-value input,
      .profile-value select {
        width: 100%;
        padding: 8px;
        font-size: 1em;
        border: 1px solid #ccc;
        border-radius: 5px;
        box-sizing: border-box;
      }
      .profile-actions {
        text-align: right;
        margin-top: 20px;
      }
      .btn-edit,
      .btn-save,
      .btn-cancel {
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
        transition: background-color 0.3s;
      }
      .btn-edit {
        background-color: #315ba7;
        color: white;
      }
      .btn-edit:hover {
        background-color: #284a8a;
      }
      .btn-save {
        background-color: #28a745;
        color: white;
        margin-right: 10px;
      }
      .btn-save:hover {
        background-color: #218838;
      }
      .btn-cancel {
        background-color: #6c757d;
        color: white;
      }
      .btn-cancel:hover {
        background-color: #5a6268;
      }

      /* Class ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ã‡πà‡∏≠‡∏ô/‡πÅ‡∏™‡∏î‡∏á element */
      .hidden {
        display: none;
      }
    </style>
  </head>
  <body>
    <header>
      <div class="sidebar-logo">
        <img
          src="ChatGPT Image 21 ‡∏°‡∏¥.‡∏¢. 2568 10_23_59.png"
          alt="Atom Industry"
          class="logo"
        />
        <img src="DeeCoin.png" alt="DEE" class="dee-logo" />
      </div>
      <div class="user-bar">
        <span class="user-icon">üë§</span>
        <span class="realname" id="headerUserName">Loading...</span>
        <button id="logoutBtn">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        <option>‡πÑ‡∏ó‡∏¢</option>
      </div>
    </header>

    <nav class="sidebar">
      <a href="index.html">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
      <a href="account.html">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</a>
      <a href="All_id.html">- ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</a>
      <a href="add-account.html">- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</a>
      <a href="wallet.html">‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡πÄ‡∏á‡∏¥‡∏ô</a>
      <a href="account-list.html">- ‡∏ï‡∏•‡∏≤‡∏î‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≤‡∏¢</a>
      <a href="withdraw.html">- ‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</a>
      <a href="transaction-history.html">- ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏≥‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°</a>
      <a href="mining-game.html">‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÄ‡∏Å‡∏°‡∏™‡πå</a>
      <a href="other-games.html">- ‡πÄ‡∏Å‡∏°‡∏™‡πå‡∏≠‡∏∑‡πà‡∏ô‡πÜ</a>
      <a href="profile.html">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</a>
      <a href="profile.html">- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</a>
      <a href="setting.html">- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</a>
      <a href="bank-card.html">- Bank card</a>
      <a href="join.html">‡∏£‡πà‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤</a>
    </nav>

    <main class="main-content-profile">
      <div class="page-title-profile">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</div>
      <div class="profile-card">
        <div class="profile-row">
          <div class="profile-col">
            <div class="profile-label">‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á</div>
            <div class="profile-value">
              <span id="profileNameView">Loading...</span>
              <input type="text" id="profileNameInput" class="hidden" />
            </div>
          </div>
          <div class="profile-col">
            <div class="profile-label">‡πÄ‡∏û‡∏®</div>
            <div class="profile-value">
              <span id="profileGenderView">Loading...</span>
              <select id="profileGenderInput" class="hidden">
                <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏® --</option>
                <option value="male">‡∏ä‡∏≤‡∏¢</option>
                <option value="female">‡∏´‡∏ç‡∏¥‡∏á</option>
              </select>
            </div>
          </div>
        </div>

        <div class="profile-row">
          <div class="profile-col">
            <div class="profile-label">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô</div>
            <div class="profile-value">
              <span id="profileNicknameView">Loading...</span>
              <input type="text" id="profileNicknameInput" class="hidden" />
            </div>
          </div>
          <div class="profile-col">
            <div class="profile-label">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ‡πÄ‡∏Å‡∏¥‡∏î</div>
            <div class="profile-value">
              <span id="profileBirthView">Loading...</span>
              <div
                id="profileBirthInputContainer"
                class="hidden"
                style="display: flex; gap: 10px"
              >
                <select id="regMonthInput"></select>
                <select id="regYearInput"></select>
              </div>
            </div>
          </div>
        </div>

        <div class="profile-row">
          <div class="profile-col">
            <div class="profile-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</div>
            <div class="profile-value" id="profilePhone">Loading...</div>
          </div>
        </div>
        <div class="profile-row">
          <div class="profile-col" style="flex: 2">
            <div class="profile-label">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà (‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£)</div>
            <div class="profile-value" id="bankAddress">Loading...</div>
          </div>
          <div class="profile-col" style="position: relative; right: 116px">
            <div class="profile-label">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</div>
            <div class="profile-value" id="bankAccountNumber">Loading...</div>
          </div>
        </div>
        <div class="profile-row">
          <div class="profile-col">
            <div class="profile-label">‡πÄ‡∏•‡∏Ç‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡∏ï‡∏±‡∏á‡∏Ñ‡πå</div>
            <div class="profile-value" id="profileKeyBag">Loading...</div>
          </div>
        </div>

        <div class="profile-actions">
          <button id="editBtn" class="btn-edit">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
          <button id="saveBtn" class="btn-save hidden">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
          <button id="cancelBtn" class="btn-cancel hidden">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        </div>
      </div>
    </main>

    <footer class="footer-set">
      <div class="android-row">
        <span>android</span>
        <img
          src="android-icon-logo-png_seeklogo-306470.png"
          class="android-icon"
          alt="android"
        />
        <img src="frame.png" class="qr-icon" alt="qr code" />
      </div>

      <div class="flag-row">
        <div class="lang-row">
          <img
            src="istockphoto-1032082612-612x612.jpg"
            alt="Thai Flag"
            class="flag"
          />
          <span class="lang-text">‡πÑ‡∏ó‡∏¢</span>
        </div>
      </div>

      <div class="side-social">
        <a href="https://www.facebook.com/profile.php?id=61579275875237"
          ><img src="Facbook.jpg" alt="Facebook"
        /></a>
        <a href="https://lin.ee/RJo5SD2"><img src="Line.jpg" alt="Line" /></a>
      </div>
    </footer>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
      import {
        getAuth,
        onAuthStateChanged,
        signOut,
      } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
      import {
        getDatabase,
        ref,
        onValue,
        update,
      } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

      const firebaseConfig = {
        apiKey: "AIzaSyCmrCEiO2kVl5j3VlwPycOYABoEiA0Kkts",
        authDomain: "kudthong-f67a2.firebaseapp.com",
        databaseURL:
          "https://kudthong-f67a2-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "kudthong-f67a2",
        storageBucket: "kudthong-f67a2.appspot.com",
        messagingSenderId: "140418020508",
        appId: "1:140418020508:web:1d2feb2b7b1bd9ea0ee959",
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const database = getDatabase(app);

      // --- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏õ‡∏µ‡πÄ‡∏Å‡∏¥‡∏î ---
      const yearSelect = document.getElementById("regYearInput");
      const monthSelect = document.getElementById("regMonthInput");

      // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏µ
      yearSelect.innerHTML = `<option value="">-- ‡∏õ‡∏µ --</option>`;
      for (let i = new Date().getFullYear() - 10; i >= 1950; i--) {
        yearSelect.innerHTML += `<option value="${i}">${i}</option>`;
      }

      // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
      const months = [
        "‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°",
        "‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå",
        "‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°",
        "‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô",
        "‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°",
        "‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô",
        "‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°",
        "‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°",
        "‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô",
        "‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°",
        "‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô",
        "‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°",
      ];
      monthSelect.innerHTML = `<option value="">-- ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô --</option>`;
      months.forEach((month, index) => {
        monthSelect.innerHTML += `<option value="${
          index + 1
        }">${month}</option>`;
      });

      let currentUserUid = null;
      let currentUserProfileRef = null;

      // --- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ---
      onAuthStateChanged(auth, (user) => {
        if (user) {
          currentUserUid = user.uid;
          currentUserProfileRef = ref(
            database,
            "usersID/" + currentUserUid + "/profile"
          );
          const bankCardRef = ref(
            database,
            "usersID/" + currentUserUid + "/bankCardInfo"
          );

          onValue(currentUserProfileRef, (snapshot) => {
            const data = snapshot.val();
            if (data) {
              const birthDate =
                data.birthYear && data.birthMonth
                  ? `${months[data.birthMonth - 1]} ${data.birthYear}`
                  : "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";

              document.getElementById("headerUserName").innerText =
                data.realName || data.nickname || user.email;

              // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (View Mode)
              document.getElementById("profileNameView").innerText =
                data.realName || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
              document.getElementById("profileGenderView").innerText =
                data.gender === "male"
                  ? "‡∏ä‡∏≤‡∏¢"
                  : data.gender === "female"
                  ? "‡∏´‡∏ç‡∏¥‡∏á"
                  : "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
              document.getElementById("profileNicknameView").innerText =
                data.nickname || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
              document.getElementById("profileBirthView").innerText = birthDate;
              document.getElementById("profileKeyBag").innerText =
                data.KeyBag || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";

              // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡πâ Input Fields (Edit Mode)
              document.getElementById("profileNameInput").value =
                data.realName || "";
              document.getElementById("profileNicknameInput").value =
                data.nickname || "";
              document.getElementById("profileGenderInput").value =
                data.gender || "";
              document.getElementById("regMonthInput").value =
                data.birthMonth || "";
              document.getElementById("regYearInput").value =
                data.birthYear || "";
            }
          });

          onValue(bankCardRef, (snapshot) => {
            // ... ‡πÇ‡∏Ñ‡πâ‡∏î‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á)
            const data = snapshot.val();
            if (data) {
              document.getElementById("bankAddress").innerText =
                data.branchAddress || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
              document.getElementById("bankAccountNumber").innerText =
                data.accountNumber || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
              document.getElementById("profilePhone").innerText =
                data.accountPhone || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
            } else {
              document.getElementById("bankAddress").innerText =
                "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏ï‡∏£‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£";
              document.getElementById("bankAccountNumber").innerText =
                "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏ï‡∏£‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£";
              document.getElementById("profilePhone").innerText = "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
            }
          });
        } else {
          window.location.href = "./login.html";
        }
      });

      // --- Logic ‡∏Å‡∏≤‡∏£‡∏™‡∏•‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î View/Edit ---
      const viewElements = document.querySelectorAll('span[id$="View"]');
      const inputElements = document.querySelectorAll(
        'input[id$="Input"], select[id$="Input"], div[id$="InputContainer"]'
      );
      const editBtn = document.getElementById("editBtn");
      const saveBtn = document.getElementById("saveBtn");
      const cancelBtn = document.getElementById("cancelBtn");

      function toggleEditMode(isEditing) {
        viewElements.forEach((el) => el.classList.toggle("hidden", isEditing));
        inputElements.forEach((el) =>
          el.classList.toggle("hidden", !isEditing)
        );

        editBtn.classList.toggle("hidden", isEditing);
        saveBtn.classList.toggle("hidden", !isEditing);
        cancelBtn.classList.toggle("hidden", !isEditing);
      }

      editBtn.addEventListener("click", () => toggleEditMode(true));
      cancelBtn.addEventListener("click", () => toggleEditMode(false));

      // --- Logic ‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ---
      saveBtn.addEventListener("click", async () => {
        if (!currentUserProfileRef) return;

        const updates = {
          realName: document.getElementById("profileNameInput").value,
          nickname: document.getElementById("profileNicknameInput").value,
          gender: document.getElementById("profileGenderInput").value,
          birthMonth: document.getElementById("regMonthInput").value,
          birthYear: document.getElementById("regYearInput").value,
        };

        try {
          await update(currentUserProfileRef, updates);
          alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
          toggleEditMode(false);
        } catch (error) {
          alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å: " + error.message);
        }
      });

      // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö ---
      document.getElementById("logoutBtn").addEventListener("click", () => {
        signOut(auth).then(() => {
          window.location.href = "./login.html";
        });
      });
    </script>
  </body>
</html>
